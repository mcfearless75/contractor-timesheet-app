<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Manager Dashboard</title>
  <!-- Bootstrap 5 CSS CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoU8x6EQf8uW9QrgiDh2zS++M1AiYkAQpF3YiFE61ur8+Xf"
    crossorigin="anonymous"
  >
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      border-radius: 0.75rem;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    table {
      background: #fff;
    }
    .navbar-brand img {
      width: 30px;
      height: auto;
      margin-right: 8px;
    }
    .no-data {
      font-style: italic;
      color: #6c757d;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
        <span>Contractor Portal</span>
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNavDash"
        aria-controls="navbarNavDash"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDash">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Submit Timesheet</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{{ url_for('dashboard') }}">Dashboard</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main container -->
  <div class="container mb-5">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card p-4">
          <h2 class="mb-4">Pending Timesheets</h2>

          {% if timesheets and timesheets|length > 0 %}
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Name</th>
                  <th>Client</th>
                  <th>Site Address</th>
                  <th>Week</th>
                  <th>Total Hrs</th>
                  <th>Est. Pay (£)</th>
                  <th>Submitted On</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for t in timesheets %}
                <tr>
                  <td>{{ t.contractor_name }}</td>
                  <td>{{ t.client }}</td>
                  <td>{{ t.site_address }}</td>
                  <td>
                    {{ t.week_start.strftime('%d/%m/%Y') }}–{{ t.week_end.strftime('%d/%m/%Y') }}
                  </td>
                  <td>{{ '%.2f'|format(t.total_hours) }}</td>
                  <td>{{ '£%.2f'|format(t.calculated_pay) }}</td>
                  <td>{{ t.submitted_on.strftime('%d/%m/%Y %H:%M') }}</td>
                  <td>
                    <a
                      href="{{ url_for('approve', ts_id=t.id) }}"
                      class="btn btn-sm btn-success"
                    >
                      Approve
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
            <p class="no-data">No pending timesheets at the moment.</p>
          {% endif %}

          <div class="mt-4">
            <a
              href="{{ url_for('export_excel') }}"
              class="btn btn-primary"
            >
              Download All Approved as Excel
            </a>
          </div>
        </div> <!-- .card -->
      </div> <!-- .col-12 -->
    </div> <!-- .row -->
  </div> <!-- .container -->

  <!-- Bootstrap 5 JS Bundle -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoU8x6EQf8uW9QrgiDh2zS++M1AiYkAQpF3YiFE61ur8+Xf"
    crossorigin="anonymous"
  ></script>
</body>
</html>
