<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manager Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #f4f4f4; }
    a.approve-btn {
      background: #28a745; color: #fff; padding: 0.25rem 0.5rem;
      text-decoration: none; border-radius: 4px;
    }
    a.approve-btn:hover { opacity: 0.8; }
    .export-link {
      display: inline-block; margin-top: 1rem; padding: 0.5rem 1rem;
      background: #007bff; color: #fff; border-radius: 4px;
      text-decoration: none;
    }
    .export-link:hover { opacity: 0.9; }
  </style>
</head>
<body>
  <h1>Manager Dashboard: Pending Timesheets</h1>
  {% if timesheets and timesheets|length > 0 %}
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Client</th>
          <th>Site Address</th>
          <th>Week</th>
          <th>Total Hrs</th>
          <th>Est. Pay (£)</th>
          <th>Submitted On</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for t in timesheets %}
        <tr>
          <td>{{ t.contractor_name }}</td>
          <td>{{ t.client }}</td>
          <td>{{ t.site_address }}</td>
          <td>{{ t.week_start.strftime('%d/%m/%Y') }}–{{ t.week_end.strftime('%d/%m/%Y') }}</td>
          <td>{{ '%.2f'|format(t.total_hours) }}</td>
          <td>{{ '£%.2f'|format(t.calculated_pay) }}</td>
          <td>{{ t.submitted_on.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>
            <a class="approve-btn" href="{{ url_for('approve', ts_id=t.id) }}">Approve</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p><em>No pending timesheets at the moment.</em></p>
  {% endif %}

  <!-- Export All Approved if any exist -->
  <a class="export-link" href="{{ url_for('export_excel') }}">Download All Approved as Excel</a>
</body>
</html>
